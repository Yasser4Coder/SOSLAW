<!DOCTYPE html>
<html>
  <head>
    <title>Auth Test</title>
  </head>
  <body>
    <h1>Authentication Test</h1>
    <div id="status">Checking authentication...</div>
    <button onclick="testLogin()">Test Login</button>
    <button onclick="testServiceRequests()">Test Service Requests</button>
    <button onclick="testNotifications()">Test Notifications</button>
    <div id="result"></div>

    <script>
      async function testLogin() {
        try {
          const response = await fetch(
            "http://localhost:5000/api/v1/auth/login",
            {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({
                email: "admin@soslaw.com",
                password: "Admin123!",
              }),
            }
          );

          const data = await response.json();
          document.getElementById("result").innerHTML =
            "<pre>" + JSON.stringify(data, null, 2) + "</pre>";

          if (data.success) {
            document.cookie = `jwt=${data.data.token}; path=/`;
            document.getElementById("status").innerHTML =
              "Logged in successfully!";
          }
        } catch (error) {
          document.getElementById("result").innerHTML =
            "Error: " + error.message;
        }
      }

      async function testServiceRequests() {
        try {
          const response = await fetch(
            "http://localhost:5000/api/v1/service-requests/my-requests",
            {
              method: "GET",
              credentials: "include",
              headers: {
                Authorization: "Bearer " + getCookie("jwt"),
              },
            }
          );

          const data = await response.json();
          document.getElementById("result").innerHTML =
            "<pre>" + JSON.stringify(data, null, 2) + "</pre>";
        } catch (error) {
          document.getElementById("result").innerHTML =
            "Error: " + error.message;
        }
      }

      async function testNotifications() {
        try {
          const response = await fetch(
            "http://localhost:5000/api/v1/notifications",
            {
              method: "GET",
              credentials: "include",
              headers: {
                Authorization: "Bearer " + getCookie("jwt"),
              },
            }
          );

          const data = await response.json();
          document.getElementById("result").innerHTML =
            "<pre>" + JSON.stringify(data, null, 2) + "</pre>";
        } catch (error) {
          document.getElementById("result").innerHTML =
            "Error: " + error.message;
        }
      }

      function getCookie(name) {
        const value = `; ${document.cookie}`;
        const parts = value.split(`; ${name}=`);
        if (parts.length === 2) return parts.pop().split(";").shift();
      }
    </script>
  </body>
</html>
